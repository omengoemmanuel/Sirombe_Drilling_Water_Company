{% extends 'adminweb/layout.html' %}
{% load static %}
{% block body %}
    <title>Drilling Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;

        }

        .footer {
            background-color: #17171c
        }

    </style>
    <main id="main" class="main">
        <div class="pagetitle">
            <h1>Drilling</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/welcome">Home</a></li>
                    <li class="breadcrumb-item active">Drilling application form</li>
                </ol>
            </nav>
        </div><!-- End Page Title -->
        <div class="container mt-5" style="background-color: blue">
            <div class="card" style="">
                <div class="card-body">
                    <h2 class="text-center mb-4">Drilling & Plumbing Services </h2>
                    <form id="multiStepForm" action="/drillinginsert" method="post">
                        {% csrf_token %}
                        <div class="step-content active" id="step1">
                            <h4>Step 1: Drilling Applications</h4>
                            <div class="form-row">
                                <div class="col-md-4 mb-3">
                                    <label for="payment-dropdown">Select Drilling Service:</label>
                                    <select class="form-control" id="payment-dropdown" name="serviceType">
                                        <option value="Choose a service">Choose a service</option>
                                        <option value="Symmetric Drilling">Symmetric Drilling</option>
                                        <option value="Core Drilling">Core Drilling</option>
                                        <option value="Geo-Technical Drilling">Geo-Technical Drilling</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">First Name:</label>
                                    <input type="text" class="form-control" id="clientName" name="fname"
                                           value="{{ drill.First_Name }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Last Name:</label>
                                    <input type="text" class="form-control" id="clientName" name="lname"
                                           value="{{ drill.Last_Name }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="contactEmail">Contact Email:</label>
                                    <input type="email" class="form-control" id="contactEmail" name="email"
                                           value="{{ drill.Email_Address }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="contactEmail">Contact Phone No:</label>
                                    <input type="text" class="form-control" id="contactEmail" name="phone"
                                           value="{{ drill.Phone_Number }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Survey Status:</label>
                                    <input type="text" class="form-control" id="clientName" name="status"
                                           value="{{ drill.status }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Expected Depth:</label>
                                    <input type="number" class="form-control" id="depth" name="depth"
                                           value="{{ drill.depth }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="downpaymentinput">Down Payment Fee:</label>
                                    <input type="text" class="form-control" id="downpaymentinput" name="down_payment"
                                           placeholder="Down Payment Fee" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Drilling Fee Charge:</label>
                                    <input type="number" class="form-control" id="drillingCharge" name="drilling_fee"
                                           placeholder="Drilling Fee Charge" readonly>
                                </div>

                            </div>
                            <button type="button" class="btn btn-primary next-btn">Next</button>
                        </div>
                        <div class="step-content" id="step2">
                            <h4>Step 2: Pump and Tank Applications</h4>
                            <div class="form-row">
                                <div class="col-md-4 mb-3">
                                    <label for="pump-dropdown">Select Pump:</label>
                                    <select class="form-control" id="pump-dropdown" name="pumpType">
                                        <option value="Choose pump">Choose pump</option>
                                        <option value="Submersible Electric Pump">Submersible Electric Pump</option>
                                        <option value="Solar Pump">Solar Pump</option>
                                        <option value="Hand Pump">Hand Pump</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="pumppaymentinput">Pump Payment Fee:</label>
                                    <input type="text" class="form-control" id="pumppaymentinput" name="pump_payment"
                                           placeholder="Pump Payment Fee" readonly>
                                </div>

                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Expected Height:</label>
                                    <input type="number" class="form-control" id="height" name="height"
                                           value="{{ drill.height }}" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Piping Fee:</label>
                                    <input type="number" class="form-control" id="pipefee" name="pipe_fee"
                                           value="" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="tank-dropdown">Select Tank:</label>
                                    <select class="form-control" id="tank-dropdown" name="tankType">
                                        <option value="Choose tank">Choose tank</option>
                                        <option value="Household Tank Plastic">Household Tank Plastic</option>
                                        <option value="Household Steel Tank">Household Steel Tank</option>
                                        <option value="Large Steel Tank">Large Steel Tank</option>
                                    </select>
                                </div>

                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Tank Fee Charge:</label>
                                    <input type="text" class="form-control" id="tankCharge" name="tank_fee"
                                           placeholder="Tank Fee Charge" readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="clientName">Pump and Tank Fee:</label>
                                    <input type="text" class="form-control" id="tankfee" name="pump_tank_fee"
                                           placeholder="Pump and Tank Fee" readonly>
                                </div>
                            </div>

                            <button type="button" class="btn btn-secondary prev-btn">Previous</button>
                            <button type="submit" class="btn btn-success">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    <footer id="footer" class="footer">
    <div class="credits">
       <h6 style="color: whitesmoke">All Right Reserved @2024 Sirombe Springs </h6>
    </div>
</footer><!-- End Footer -->


        <!-- Bootstrap JS and dependencies -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@1.16.0/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                crossorigin="anonymous"></script>
        <script>
            // JavaScript for multi-step form navigation
            $(document).ready(function () {
                var currentStep = 1;

                $(".next-btn").click(function () {
                    $("#step" + currentStep).removeClass("active");
                    currentStep++;
                    $("#step" + currentStep).addClass("active");
                });

                $(".prev-btn").click(function () {
                    $("#step" + currentStep).removeClass("active");
                    currentStep--;
                    $("#step" + currentStep).addClass("active");
                });


            });

            function calculatePipeCharge() {
                const height = parseFloat(document.getElementById("height").value) || 0;
                let pipefee;

                if (height <= 100) {
                    pipefee = height * 1000;
                } else if (height > 100 && height <= 200) {
                    pipefee = height * 1500;
                } else if (height > 200 && height <= 300) {
                    pipefee = height * 2000;
                } else if (height > 300) {
                    pipefee = height * 2500;
                } else {
                    pipefee = "N/A";
                }

                document.getElementById("pipefee").value = pipefee;
                calculateTankFee(); // Trigger fee calculation after updating pipe fee
            }

            // Call this function on page load to calculate pipe charge based on default height
            window.onload = function () {
                calculatePipeCharge();
            };

            function calculateDrillingCharge() {
                const depth = parseFloat(document.getElementById("depth").value) || 0;
                const downpaymentinput = parseFloat(document.getElementById("downpaymentinput").value) || 0;

                let drillingCharge;

                if (depth <= 100) {
                    drillingCharge = (depth * 1000) + downpaymentinput;
                } else if (depth > 100 && depth <= 200) {
                    drillingCharge = (depth * 1500) + downpaymentinput;
                } else if (depth > 200 && depth <= 300) {
                    drillingCharge = (depth * 2000) + downpaymentinput;
                } else if (depth > 300) {
                    drillingCharge = (depth * 2500) + downpaymentinput;
                } else {
                    drillingCharge = "Select drilling services";
                }
                document.getElementById("drillingCharge").value = drillingCharge;
            }

            // Trigger when drilling service is selected
            document.getElementById('payment-dropdown').addEventListener('change', function () {
                const paymentType = this.value;
                if (paymentType && paymentType !== "Choose a service") {
                    fetch(`/get-downpayment/?name=${paymentType}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.downpayment) {
                                document.getElementById('downpaymentinput').value = data.downpayment;
                            } else {
                                document.getElementById('downpaymentinput').value = 'N/A';
                            }
                            // Trigger drilling charge calculation after updating downpayment
                            calculateDrillingCharge();
                        })
                        .catch(error => {
                            console.error('Error fetching downpayment:', error);
                        });
                } else {
                    document.getElementById('downpaymentinput').value = '';
                    document.getElementById('drillingCharge').value = '';
                }
            });

            document.getElementById('pump-dropdown').addEventListener('change', function () {
                const costType = this.value;
                if (costType) {
                    fetch(`/get-pump/?pump=${costType}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.cost) {
                                document.getElementById('pumppaymentinput').value = data.cost;
                            } else {
                                document.getElementById('pumppaymentinput').value = 'N/A';
                            }
                            // Trigger fee calculation after updating pump payment
                            calculateTankFee();
                        })
                        .catch(error => {
                            console.error('Error fetching cost:', error);
                        });
                } else {
                    document.getElementById('pumppaymentinput').value = '';
                    calculateTankFee();
                }
            });

            document.getElementById('tank-dropdown').addEventListener('change', function () {
                const tankType = this.value;
                if (tankType) {
                    fetch(`/get-tank/?tank=${tankType}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.cost) {
                                document.getElementById('tankCharge').value = data.cost;
                            } else {
                                document.getElementById('tankCharge').value = 'N/A';
                            }
                            // Trigger fee calculation after updating tank charge
                            calculateTankFee();
                        })
                        .catch(error => {
                            console.error('Error fetching cost:', error);
                        });
                } else {
                    document.getElementById('tankCharge').value = '';
                    calculateTankFee();
                }
            });

            function calculateTankFee() {
                const pumppayment = parseFloat(document.getElementById('pumppaymentinput').value) || 0;
                const pipefee = parseFloat(document.getElementById('pipefee').value) || 0;
                const tankCharge = parseFloat(document.getElementById('tankCharge').value) || 0;

                // Calculate the total tank fee
                const totalTankFee = pumppayment + pipefee + tankCharge;

                // Update the tankfee field
                document.getElementById('tankfee').value = totalTankFee.toFixed(2); // Show 2 decimal places
            }

        </script>


    </main>
{% endblock %}